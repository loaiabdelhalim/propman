// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ManagementType {
  WEG
  MV
}

enum UnitType {
  Apartment
  Office
  Garden
  Parking
}

model Property {
  id                String    @id @default(uuid())
  uniqueNumber      String?   @unique
  managementType    ManagementType
  name              String
  propertyManagerId String
  accountantId      String
  declarationOfDivision Json? // { fileId: string, uploadedAt: DateTime, aiExtracted: boolean }
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")
  
  buildings         Building[]

  @@map("properties")
}

model Building {
  id               String   @id @default(uuid())
  propertyId       String   @map("property_id")
  address          Json     // { street: string, houseNumber: string, postalCode?: string, city?: string, country?: string }
  additionalDetails String? @map("additional_details")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")
  
  property         Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  units            Unit[]

  @@map("buildings")
}

model Unit {
  id                String   @id @default(uuid())
  buildingId        String   @map("building_id")
  unitNumber        String   @map("unit_number")
  type              UnitType
  floor             String?
  entrance          String?
  sizeSqm           Float    @map("size_sqm")
  coOwnershipShare  Float    @map("co_ownership_share")
  constructionYear  Int?     @map("construction_year")
  rooms             Int?
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  
  building          Building @relation(fields: [buildingId], references: [id], onDelete: Cascade)

  @@map("units")
}

